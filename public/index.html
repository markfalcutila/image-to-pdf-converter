<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image & File to PDF Converter</title>
  <link rel="stylesheet" href="style.css">
  <style>
   
  </style>
</head>
<body>
  <div class="main-container">

    <div class="header">
      <div class="logo">
        <span class="logo1">MISSY</span>
        <span class="logo2">mittytui</span>
      </div>

    </div>
    <div class="container">
      <h2>Convert & Merge to PDF</h2>
      <form id="uploadForm">
        <div id="dropzone" class="dropzone">
          Drag & drop images, PDFs, or Excel files here<br>or click to select files
        </div>
        <input type="file" id="fileInput" name="files" multiple style="display:none"
              accept=".jpg,.jpeg,.png,.bmp,.heic,.heif,.pdf,.xlsx">

        <!-- Sorting Option -->
        <label for="sortOrder"><strong>File Order:</strong></label>
        <select id="sortOrder" name="sortOrder" class="convert-select">
          <option value="asc">Ascending (First uploaded → Last)</option>
          <option value="desc">Descending (Last uploaded → First)</option>
        </select>

        <ul id="fileList" class="file-list"></ul>

        <!-- Buttons -->
        <div class="button-group">
          <button type="submit" class="btn" id="convertBtn" disabled>Convert & Merge</button>
          <button type="button" class="btn btn-reset" id="resetBtn" style="display:none;">Reset</button>
        </div>
      </form>
      <div class="result" id="result"></div>
    </div>
      <img class="cat2" src="hapihapi.gif" alt="">
      <img class="cat1" src="catdance.gif" alt="">
  </div>


  </div>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const convertBtn = document.getElementById('convertBtn');
    const resetBtn = document.getElementById('resetBtn');
    const result = document.getElementById('result');
    let files = [];

    dropzone.addEventListener('click', () => fileInput.click());
    dropzone.addEventListener('dragover', e => {
      e.preventDefault();
      dropzone.classList.add('dragover');
    });
    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      dropzone.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener('change', e => handleFiles(e.target.files));

    function handleFiles(selectedFiles) {
      for (const file of selectedFiles) {
        if (!files.some(f => f.name === file.name && f.size === file.size)) {
          files.push(file);
        }
      }
      renderFileList();
    }

    function renderFileList() {
      fileList.innerHTML = files.map(f => `<li>${f.name}</li>`).join('');
      const hasFiles = files.length > 0;
      convertBtn.disabled = !hasFiles;
      resetBtn.style.display = hasFiles ? 'inline-block' : 'none';
    }

    // Reset button functionality
    resetBtn.addEventListener('click', () => {
      files = [];
      fileList.innerHTML = '';
      convertBtn.disabled = true;
      resetBtn.style.display = 'none';
      result.innerHTML = '';
      fileInput.value = '';
    });

    document.getElementById('uploadForm').addEventListener('submit', async e => {
      e.preventDefault();
      convertBtn.disabled = true;
      result.textContent = 'Processing...';

      const formData = new FormData();
      const sortOrder = document.getElementById('sortOrder').value;

      // Sort files according to user selection
      const sortedFiles = sortOrder === 'asc' ? files : [...files].reverse();
      sortedFiles.forEach((f, index) => {
        formData.append('files', f);
        formData.append('fileOrder', index); // optional
      });
      formData.append('sortOrder', sortOrder);

      try {
        const res = await fetch('/convert', { method: 'POST', body: formData });
        const data = await res.json();
        if (data.success) {
          const link = document.createElement('a');
          link.href = `data:application/pdf;base64,${data.data}`;
          link.download = data.filename;
          link.textContent = `Download ${data.filename}`;
          result.innerHTML = '';
          result.appendChild(link);
        } else {
          result.textContent = 'Conversion failed.';
        }
      } catch (err) {
        result.textContent = 'Error: ' + err.message;
      }

      convertBtn.disabled = false;
    });
  </script>
</body>
</html>
